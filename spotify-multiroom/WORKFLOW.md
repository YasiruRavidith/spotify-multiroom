# ğŸµ Spotify Multi-Room Player - Visual Workflow

## ğŸ”„ How the System Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     YOUR SPOTIFY ACCOUNT                      â”‚
â”‚                   (Premium - Credentials in backend)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    OAuth Authentication
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND SERVER                           â”‚
â”‚  - Stores Spotify credentials                                â”‚
â”‚  - Provides OAuth tokens                                     â”‚
â”‚  - WebSocket server for sync                                 â”‚
â”‚  - Password verification                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                 â”‚
     Provides Tokens                    WebSocket Sync
            â”‚                                 â”‚
            â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SPOTIFY WEB PLAYBACK SDK (Browser)             â”‚
â”‚  - Creates virtual Spotify device                           â”‚
â”‚  - Shows in your Spotify device list                        â”‚
â”‚  - Plays audio through browser                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    Multiple Browsers
           â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼         â–¼        â–¼        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
  â”‚Browserâ”‚ â”‚Browserâ”‚ â”‚Browserâ”‚ â”‚Browserâ”‚
  â”‚   1   â”‚ â”‚   2   â”‚ â”‚   3   â”‚ â”‚   4   â”‚
  â”‚  ğŸ”Š   â”‚ â”‚  ğŸ”Š   â”‚ â”‚  ğŸ”Š   â”‚ â”‚  ğŸ”Š   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
  Laptop    Phone     Tablet    Desktop
```

---

## ğŸ“± User Journey

### 1ï¸âƒ£ Setup (One-time)

```
Developer Dashboard â†’ Get Credentials â†’ Add to .env â†’ Authorize
     â†“                      â†“               â†“            â†“
Create Spotify App    Client ID &     backend/.env   Get Refresh
                    Client Secret                     Token
```

### 2ï¸âƒ£ Daily Use

```
Open Browser â†’ Enter Password â†’ Wait for Ready â†’ Control from Spotify
     â†“              â†“                â†“                  â†“
http://...    yasiru2003      "Device Ready"    Select device in
                                                  Spotify app
```

### 3ï¸âƒ£ Multi-Room Setup

```
Connect Bluetooth     Open Player          Wait for Ready
  Speakers         on Each Device
     â†“                    â†“                      â†“
Speaker A â†â”€ Laptop â”€â”€â†’ Browser 1 â”€â”€â†’ [Password] â”€â”€â†’ ğŸŸ¢ Ready
Speaker B â†â”€ Phone  â”€â”€â†’ Browser 2 â”€â”€â†’ [Password] â”€â”€â†’ ğŸŸ¢ Ready
Speaker C â†â”€ Tablet â”€â”€â†’ Browser 3 â”€â”€â†’ [Password] â”€â”€â†’ ğŸŸ¢ Ready
     â”‚                    â”‚                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
              Select device from Spotify app
                          â”‚
                          â–¼
              ğŸµ All play synchronized! ğŸµ
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Initial Authorization (One-time Setup)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Visit /auth/url
       â”‚
       â–¼
Click "Authorize"
       â”‚
       â–¼
Login to Spotify Premium
       â”‚
       â–¼
Spotify redirects to /callback
       â”‚
       â–¼
Backend exchanges code for tokens
       â”‚
       â–¼
Refresh Token saved to .env
       â”‚
       â–¼
âœ… Setup Complete!


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Daily Usage (Automatic)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User opens player
       â”‚
       â–¼
Frontend requests token
       â”‚
       â–¼
Backend uses refresh token
       â”‚
       â–¼
Gets new access token from Spotify
       â”‚
       â–¼
Returns to frontend
       â”‚
       â–¼
Frontend creates Spotify device
       â”‚
       â–¼
âœ… Device appears in Spotify!
```

---

## ğŸµ Playback Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phone/Laptop â”‚  â† You control playback here
â”‚ Spotify App  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   1. Play song
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Select Device:      â”‚
â”‚  â—‹ iPhone            â”‚
â”‚  â—‹ Desktop           â”‚
â”‚  â— Multi-Room Player â”‚ â† Select this!
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   2. Playback command
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spotify Cloud     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
   3. Stream to device
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼         â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Browser1â”‚ â”‚Browser2â”‚ â”‚Browser3â”‚ â”‚Browser4â”‚
â”‚  ğŸµ    â”‚ â”‚  ğŸµ    â”‚ â”‚  ğŸµ    â”‚ â”‚  ğŸµ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Same       Same      Same       Same
   Song       Song      Song       Song
   Same       Same      Same       Same
   Time       Time      Time       Time
```

---

## ğŸŒ Network Architecture

### Local Network (Development)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Your Local Network (WiFi)            â”‚
â”‚                                                â”‚
â”‚  Computer (Backend)                            â”‚
â”‚    â”œâ”€ localhost:3001 (API)                     â”‚
â”‚    â””â”€ localhost:3001 (WebSocket)               â”‚
â”‚                                                â”‚
â”‚  Computer (Frontend Dev Server)                â”‚
â”‚    â””â”€ localhost:5173 (React App)               â”‚
â”‚                                                â”‚
â”‚  Phone ğŸ“±                                       â”‚
â”‚    â””â”€ 192.168.1.100:5173 (Access via IP)      â”‚
â”‚                                                â”‚
â”‚  Tablet ğŸ“±                                      â”‚
â”‚    â””â”€ 192.168.1.100:5173 (Access via IP)      â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production (Deployed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  INTERNET                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
    Backend Server      Frontend CDN
    (Railway)           (Vercel)
           â”‚                    â”‚
    your-app            your-app
    .railway.app        .vercel.app
           â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚   API + WS    â”‚   â”‚ Static HTML â”‚
    â”‚   :443        â”‚   â”‚     JS      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     CSS     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                         User's Browser
```

---

## ğŸ“Š Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REAL-TIME SYNC                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Device 1: Song starts playing
    â”‚
    â”œâ”€â†’ Updates local state
    â”‚
    â””â”€â†’ Sends via WebSocket â”€â”€â”€â”
                                â”‚
Device 2: Receives update  â†â”€â”€â”€â”€â”¤
    â”‚                           â”‚
    â”œâ”€â†’ Updates UI              â”‚
    â”‚                           â”‚
    â””â”€â†’ Player syncs      â†â”€â”€â”€â”€â”€â”˜
                                â”‚
Device 3: Receives update  â†â”€â”€â”€â”€â”¤
    â”‚                           â”‚
    â”œâ”€â†’ Updates UI              â”‚
    â”‚                           â”‚
    â””â”€â†’ Player syncs      â†â”€â”€â”€â”€â”€â”˜

All devices show:
  âœ“ Same track info
  âœ“ Same album art
  âœ“ Same progress bar
  âœ“ Same play/pause state
```

---

## ğŸ¯ Component Interaction

```
Frontend Components:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      App.jsx           â”‚
â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Password Screen  â”‚  â”‚ â† If password enabled
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Player Setup     â”‚  â”‚ â† Initialize SDK
â”‚  â”‚ - Load SDK       â”‚  â”‚
â”‚  â”‚ - Create Device  â”‚  â”‚
â”‚  â”‚ - Register       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Playback Display â”‚  â”‚ â† Show current track
â”‚  â”‚ - Album Art      â”‚  â”‚
â”‚  â”‚ - Track Info     â”‚  â”‚
â”‚  â”‚ - Progress Bar   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WebSocket Client â”‚  â”‚ â† Sync with others
â”‚  â”‚ - Connect        â”‚  â”‚
â”‚  â”‚ - Listen         â”‚  â”‚
â”‚  â”‚ - Broadcast      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ State Management

```
Application State:

authenticated: false â”€â”€â†’ true (after password)
      â”‚
      â–¼
playerReady: false â”€â”€â†’ true (SDK loaded)
      â”‚
      â–¼
deviceReady: false â”€â”€â†’ true (device created)
      â”‚
      â–¼
playbackState: null â”€â”€â†’ { track, isPlaying, progress }
```

---

**This visual guide helps understand the complete system architecture!**
